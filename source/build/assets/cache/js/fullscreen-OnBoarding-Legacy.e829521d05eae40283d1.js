"use strict";(self.webpackJsonpDeezer=self.webpackJsonpDeezer||[]).push([[4822],{"YG/N":(e,t,s)=>{s.d(t,{A:()=>m});var i=s("WKgy"),r=s("q1tI"),n=s("juqV");var o=s("TRpf"),c=s("DVo4"),l=s("nxAS");const d=(0,o.Ng)(null,{closeScreen:l.Fn})((({customClose:e,closeScreen:t})=>{const s=e||t;return r.createElement(c.J,{position:"absolute",top:"8px",right:"8px",size:"lg",onClick:s,zIndex:2})}));i.A.addReducers({modal:l.Ay});const m={Body:({className:e,children:t})=>{const s=(0,n.A)("full-screen-body",e);return r.createElement("div",{className:s},t)},Close:d,Footer:({className:e,children:t})=>{const s=(0,n.A)("full-screen-footer",e);return r.createElement("div",{className:s},t)},Header:({className:e,children:t})=>{const s=(0,n.A)("full-screen-header",e);return r.createElement("h1",{className:s},t)}}},Mg2f:(e,t,s)=>{s.r(t),s.d(t,{default:()=>le});var i,r,n=s("q1tI"),a=s("TRpf"),o=s("Wp0Y"),c=s("WmA5"),l=s("aHAS"),d=s("2+nF"),h=s("YG/N"),p=s("GkjM"),m=s("X6oL"),u=s("hz5U");let A=(0,m.Ay)({pagename:"onboarding",pagecategory:"onboarding-artists",virtualpageurl:"/onboarding-completed",event:"virtualpageview"},{dispatchOnMount:!0})(i=class extends n.Component{render(){return n.createElement("div",{className:"onboarding-screen-finish"},n.createElement(h.A.Header,{className:"onboarding-screen-finish-header"},(0,o.AP)("Splendide !")),n.createElement("div",{key:"onboarding-screen-finish-animation",className:"onboarding-screen-finish-animation"},r||(r=n.createElement("div",{className:"onboarding-screen-finish-loader"})),n.createElement("img",{className:"onboarding-screen-finish-loader-picture",width:"204",src:u.A.getImageSrc("misc","4d557016ec84834d42fbea9c97d3b4eb",204,204,"none")})))}})||i;var g=s("RGaU"),S=s("HmE0"),f=s("CdHq"),b=s("ZDlI"),E=s("eOc8"),x=s("y7xR"),v=s("pVdW"),L=s("TDRX"),y=s("nrKQ");const _=(e,t)=>e.map((e=>({id:e.ART_ID,name:e.ART_NAME,image:e.ART_PICTURE||{format:"jpg",type:"artist",md5:"d41d8cd98f00b204e9800998ecf8427e"},isSelected:!1,reference:t}))),C=e=>e.id,T=(e,t,s)=>{y.A.call({method:"onboarding.getTopArtists",data:{CONTEXT:e},success:e=>{t(_(e))},error:s})};var R=s("34sk"),N=s("kSUS"),w=s("3o0m"),I=s("Z9kq"),P=s("LjZa"),k=s("ntT5"),O=s("5G9X"),G=s("rXlm"),D=s("MG7B");const M=({artist:e,onClick:t})=>n.createElement("div",{className:"onboarding-screen-search-item",onClick:t},n.createElement("img",{className:"onboarding-screen-search-item-picture",src:u.A.getImageSrc("artist",e.image.md5,55,55)}),n.createElement("div",{className:"onboarding-screen-search-item-name ellipsis"},e.name));var z,B=s("4liH"),W=s("7E8A");class X extends n.Component{constructor(...e){super(...e),this.state={isOpened:!1,searchResult:[],query:"",searchResultLoaded:!1},this.textInput=n.createRef(),this.popoverElement=n.createRef(),this.focusInput=()=>{this.textInput.current&&this.textInput.current.focus()},this.searchArtist=(0,N.A)((()=>{var e,t,s,i;this.state.query&&(e=this.state.query,t=this.props.context,s=this.setSearchResult,i=P.A,y.A.call({method:"onboarding.searchArtist",data:{QUERY:e,CONTEXT:t},success:e=>{s(_(e.data))},error:i}))}),500),this.setSearchResult=e=>{this.setState({searchResult:e,searchResultLoaded:!0,isOpened:!0})},this.clickOutsideSearch=e=>{const t=e.target;null===this.textInput.current||this.textInput.current.contains(t)||t.className.includes("onboarding-screen-search-item")||this.closePopper()},this.closePopper=()=>{this.props.onPopoverOpened(!1),this.setState({isOpened:!1})},this.onArtistSelection=e=>{(0,k.Fw)(this.state.query,"",W.CONTEXT_PAGE_SEARCH_ONBOARDING,B.SA,{...e,type:O.Ay.Artist}),this.closePopper(),this.props.onArtistSelection(e),this.setState({query:"",searchResult:[],isOpened:!1,searchResultLoaded:!1})},this.onInputChange=e=>{const t=Boolean(e.target.value);this.setState({isOpened:t,query:e.target.value,searchResultLoaded:!1}),this.props.onPopoverOpened(t),t||this.closePopper(),this.searchArtist()},this.onWrapperClick=()=>{this.focusInput(),this.props.onPopoverOpened(this.state.searchResultLoaded),this.setState({isOpened:this.state.searchResultLoaded})},this.onCancelClick=()=>{this.props.onPopoverOpened(!1),this.setState({query:"",searchResult:[],isOpened:!1,searchResultLoaded:!1})}}componentDidMount(){document.addEventListener("click",this.clickOutsideSearch,!0)}get resultList(){if(!this.state.searchResultLoaded)return z||(z=n.createElement(g.k,null));if(!this.state.searchResult.length){const e=(0,o.AP)("Aucun résultat pour «<strong>%s</strong>»",{sprintf:[" "+(0,D.A)(this.state.query)+" "]});return n.createElement("div",{className:"onboarding-screen-search-no-results",dangerouslySetInnerHTML:{__html:e}})}return n.createElement(G.A,{className:"onboarding-screen-search-list"},this.state.searchResult.map((e=>n.createElement(M,{key:e.id,artist:e,onClick:this.onArtistSelection.bind(this,e)}))))}render(){return n.createElement(f.s,{w:"100%"},n.createElement(I.D,{ref:this.textInput,id:"onBoardingSearchAnchor",className:"onboarding-screen-search-input",type:"text",autoComplete:"off",placeholder:(0,o.AP)("Rechercher"),onChange:this.onInputChange,value:this.state.query,onClick:this.onWrapperClick}),this.state.isOpened&&n.createElement(w.A,{anchorNode:this.textInput.current,className:"onboarding-screen-search-popper"},this.resultList))}}var U=s("+9dH"),q=s("juqV"),j=s("siwx"),F=s("MaVz"),H=s("//u0");const V=242;class Y extends n.Component{constructor(...e){super(...e),this.self=n.createRef(),this.onClick=()=>{this.props.onClick(this.props.id,this.self.current)}}get imageUrl(){const{image:{type:e,md5:t}}=this.props;return u.A.getImageSrc(e,t,V,V)}render(){const e=(0,q.A)("onboarding-screen-artist-item",{"onboarding-screen-artist-item--selected":this.props.isSelected});return n.createElement("div",{ref:this.self,className:e,onClick:this.onClick},n.createElement(F.P.div,{layout:!0,transition:{duration:.2}},n.createElement(F.P.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.2,delay:.1}},n.createElement(L.a,{w:"100%",h:"100%",borderRadius:"rounded",borderColor:this.props.isSelected?"border.accent.primary.default":"transparent",borderWidth:"border.m",borderStyle:"solid",overflow:"hidden",transition:"border-color 0.5s ease",position:"relative",_after:{content:'""',position:"absolute",inset:0,h:"100%",w:"100%",transition:"opacity 0.5s ease",backgroundColor:"background.accent.onLight.default",opacity:this.props.isSelected?.6:0},_hover:{_after:{opacity:.6}}},n.createElement(j._,{loading:"lazy",w:"100%",h:"100%",zIndex:1,src:this.imageUrl,htmlWidth:V,htmlHeight:V}),n.createElement(H.C,{sx:{color:"icon.accent.primary.default",position:"absolute",top:"calc(50% - 25px)",left:"calc(50% - 18px)",boxSize:8,opacity:this.props.isSelected?1:0,transition:"opacity 0.5s ease"}})),n.createElement("div",{className:"onboarding-screen-artist-item-name ellipsis"},this.props.name))))}}const J=Y;var K,Z=s("PBDT");const Q=e=>{const[t,s]=(0,n.useState)(!1);if((0,n.useEffect)((()=>{const e=setTimeout((()=>{s(!0)}),250);return()=>clearTimeout(e)}),[]),!t)return K||(K=n.createElement(Z.o,null,n.createElement(g.k,null)));const i=e.artists.map((t=>n.createElement(J,(0,U.A)({key:t.id,onClick:e.toggleArtistSelection},t))));return n.createElement(L.a,{className:"onboarding-screen-grid-wrapper",w:"100%"},n.createElement(G.A,{className:"onboarding-screen-grid-scroller"},n.createElement(L.a,{className:"onboarding-screen-grid"},i)))};let $=function(e){return e.Welcome="welcome",e.Improve="improve",e}({});const ee=({onSelected:e,context:t})=>{const[s,i]=(0,n.useState)([]),[r,a]=(0,n.useState)();return(0,n.useEffect)((()=>{((e,t,s)=>{y.A.call({method:"onboarding.getTopGenres",data:{CONTEXT:e},success:e=>{(e=>{i(e.map((e=>({...e,isSelected:!1}))))})(e.map((e=>({id:e.GENRE_ID,name:e.GENRE_NAME}))))},error:s})})(t,0,P.A)}),[]),n.createElement(E.B,{direction:"row",spacing:3,align:"center",w:"fit-content",py:"4px"},s.map((t=>{const s=t.id===(null==r?void 0:r.id);return n.createElement(S.$n,{key:t.id,variant:s?"contain":"outline",onClick:()=>(t=>{const s=r&&r.id===t.id?void 0:t;a(s),e(s)})(t),size:"sm",fontWeight:"normal"},t.name)})))};var te,se,ie=s("xobL"),re=s("g1Fm"),ne={name:"y0dhib",styles:"&::-webkit-scrollbar{display:none;}scrollbar-width:none"};let ae=(0,m.Ay)({pagename:"onboarding",pagecategory:"onboarding-artists",virtualpageurl:"/onboarding-artists",event:"virtualpageview"},{dispatchOnMount:!0})(te=class extends n.Component{constructor(...e){super(...e),this.state={artistList:[],artistListLoaded:!1,finalizing:!1,searchDisplay:!0,popoverOpened:!1,canShowMaxAlert:!0},this.currentGetRelatedCall=void 0,this.selectedArtists={},this.mainListSnapShot=[],this.selectedGenre=void 0,this.addArtistAtTopOfList=e=>{const t=this.state.artistList.filter((t=>e.id!==t.id));this.setState({artistList:this.rebuildArtistList([e,...t])})},this.addRelatedArtistsToList=(e,t)=>{const s=[...this.state.artistList],i=s.findIndex((t=>e.id===t.id))+1;s.splice(i,0,...t),this.setState({artistList:this.rebuildArtistList(s)})},this.toggleArtist=(e,t)=>{if(this.selectedArtists[e])delete this.selectedArtists[e];else{if(!this._maxArtistSelectionSafeGuard())return;this.selectedArtists[e]=!0}const s=this.rebuildArtistList(this.state.artistList);this.setState({artistList:s});const i=s.find((t=>t.id===e&&t.isSelected));i&&this.getRelatedArtistsAndAddTolist({...i,reference:t})},this.onGenreSelected=e=>{this.setState({artistListLoaded:!1},(()=>{if(e)void 0===this.selectedGenre&&(this.mainListSnapShot=this.state.artistList),this.selectedGenre=e,t=e.id,s=this.props.context,i=e=>this.setState({artistList:this.rebuildArtistList(e),artistListLoaded:!0}),r=P.A,y.A.call({method:"onboarding.getTopArtistsByGenre",data:{GENRE_ID:t,CONTEXT:s},success:e=>{i(_(e))},error:r});else{if(this.selectedGenre=void 0,this.mainListSnapShot)return void this.setState({artistList:this.rebuildArtistList(this.mainListSnapShot),artistListLoaded:!0});T(this.props.context,(e=>this.setState({artistList:this.rebuildArtistList(e),artistListLoaded:!0})),P.A)}var t,s,i,r}))},this.getRelatedArtistsAndAddTolist=e=>{var t,s,i,r,n,a;this.currentGetRelatedCall=(t=e,s=this.state.artistList,i=this.props.context,r=this.addRelatedArtistsToList,n=P.A,(a=this.currentGetRelatedCall)&&y.A.cancel(a),y.A.call({method:"onboarding.getRelatedArtists",data:{ART_ID:t.id,CONTEXT:i,EXCLUDED_ARTISTS:s.map(C)},success:e=>{r(t,_(e,t.reference))},error:n}))},this.onCompleted=()=>{if(this.setState({finalizing:!0}),this.props.context===$.Improve){const e=(0,ie.mI)({SERVER_TIMESTAMP:this.props.serverTimestamp,clientTimestampDelta:this.props.clientTimestampDelta});this.props.addMultipleFavoritesAction(this.selectedArtistList,O.Ay.Artist,e,{},!1)}var e,t,s,i;e=this.selectedArtistList,t=this.props.context,s=()=>this.props.finishStep(),i=P.A,y.A.call({method:"onboarding.setArtists",data:{CONTEXT:t,SELECTED_ARTISTS:e},success:()=>{s()},error:i})},this.onSearchSelected=e=>{this._maxArtistSelectionSafeGuard()&&(this.selectedArtists[e.id]=!0,this.mainListSnapShot=[e,...this.mainListSnapShot.filter((t=>t.id!==e.id))],this.addArtistAtTopOfList({...e,isSelected:!0}),this.getRelatedArtistsAndAddTolist(e))},this.onPopoverOpened=e=>{this.setState({popoverOpened:e})}}componentDidMount(){T(this.props.context,(e=>this.setState({artistList:e,artistListLoaded:!0})),P.A)}get selectedArtistList(){return Object.keys(this.selectedArtists)}get artistGrid(){return this.state.artistListLoaded?n.createElement(Q,{artists:this.state.artistList,toggleArtistSelection:this.toggleArtist}):se||(se=n.createElement("div",{className:"onboarding-screen-artists-loader"},n.createElement(g.k,null)))}get isSelectionCompleted(){return this.selectedArtistList.length>=this.props.minArtistsToSelect}get nextButton(){let e,t=!0;const s=this.selectedArtistList.length;return 0===this.props.minArtistsToSelect?(e=(0,re.A)((0,o.AP)("TERMINER"),!0),t=!1):s?s<this.props.minArtistsToSelect?e=(0,o.WI)("artistselectionoptimization_action_chooseXmoreartistsUPP_web","artistselectionoptimization_action_chooseXmoreartistsUPP_web",{sprintf:[this.props.minArtistsToSelect-s],count:this.props.minArtistsToSelect-s}):(e=(0,o.WI)("artistselectionoptimization_action_continuewithXartistsUPP_web","artistselectionoptimization_action_continuewithXartistsUPP_web",{sprintf:[s],count:s}),t=!1):e=(0,o.WI)("artistselectionoptimization_action_chooseatleastXartistsUPP_web","artistselectionoptimization_action_chooseatleastXartistsUPP_web",{sprintf:[this.props.minArtistsToSelect],count:this.props.minArtistsToSelect}),n.createElement(S.$n,{isDisabled:t,onClick:this.onCompleted},e)}showMaxAlert(){this.state.canShowMaxAlert&&alert((0,o.AP)("errormessage_title_maximumreached_web")+"\n"+(0,o.AP)("errormessage_text_maxnberartistreachedforthisstage_web")+"\n"+(0,o.AP)("errormessage_text_dontworrycanaddmorelater_web"))}rebuildArtistList(e){return e.map((e=>({...e,isSelected:Boolean(this.selectedArtists[e.id])})))}_maxArtistSelectionSafeGuard(){return!(this.selectedArtistList.length>=this.props.maxArtistsToSelect&&(this.showMaxAlert(),1))}render(){const e=$.Welcome;return n.createElement(n.Fragment,null,n.createElement(f.s,{w:"100%",alignItems:"center",justifyContent:"center"},n.createElement(b.m,{maxW:"800px"},n.createElement(E.B,{direction:"column",spacing:"4",textAlign:"center"},n.createElement(x.D,{as:"h1",fontSize:"30px",className:"onboarding-screen-artists-header"},e?(0,o.AP)("Bienvenue"):(0,re.A)((0,o.AP)("artistselectionoptimization_action_chooseartistUPP_web"),!0)),n.createElement(v.E,{fontSize:"14px"},e?(0,o.AP)("artistselectionoptimization_text_chooseartistsformorepersonalizedreco_web"):(0,o.AP)("onboardingartistpicker_text_improverecoselectfavartists_web")),n.createElement(X,{onArtistSelection:this.onSearchSelected,onPopoverOpened:this.onPopoverOpened,context:this.props.context})))),n.createElement(f.s,{w:"100%",alignItems:"center",justifyContent:{base:"flex-start",md:"center"},overflow:"auto",css:ne},this.props.showGenreFilter&&n.createElement(ee,{onSelected:this.onGenreSelected.bind(this),context:this.props.context})),n.createElement(L.a,{w:"100%",id:"artist-grid",flex:"1"},n.createElement(b.m,{maxW:"1400px",display:"flex",alignItems:"center",justifyContent:"center",h:"100%"},this.artistGrid)),n.createElement(f.s,{w:"100%",alignItems:"center",justifyContent:"center"},n.createElement(b.m,{maxW:"800px",display:"flex",alignItems:"center",justifyContent:"center",mb:"6",className:"onboarding-block-footer"},this.nextButton)))}})||te;const oe=(0,a.Ng)((({user:e})=>({clientTimestampDelta:(0,ie.gE)(e),serverTimestamp:(0,ie.mS)(e)})),{addMultipleFavoritesAction:R.jo})(ae);var ce;const le=({closeScreen:e,showGenreFilter:t=!1,showCloseButton:s=!1,context:i=$.Welcome,onBoardingMinSelection:r=15,maxSelection:m=500,callbackLink:u="/"})=>{const[g,S]=(0,n.useState)(!1),f=(0,a.wA)();return n.createElement(E.B,{direction:"column",spacing:"6",h:"100vh",w:"100vw",position:"absolute",top:"0",left:"0",px:"4",py:"6"},s?n.createElement(h.A.Close,{customClose:e}):null,g?ce||(ce=n.createElement(A,null)):n.createElement(oe,{context:i,showGenreFilter:t,minArtistsToSelect:i===$.Welcome?r:0,maxArtistsToSelect:m,finishStep:()=>{S(!0),i!==$.Welcome?f((0,l.Sk)((()=>{c.A.replace(u),e()}))):(0,d.Cb)()}}),n.createElement(h.A.Footer,null,n.createElement(p.A,{to:"http://support.deezer.com/",target:"_blank",className:"onboarding-screen-help"},(0,o.AP)("Aide"))))}},MG7B:(e,t,s)=>{function i(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}s.d(t,{A:()=>i})},PBDT:(e,t,s)=>{s.d(t,{o:()=>a});var i=s("nKUr"),r=s("M62g"),n=s("xi32");const a=(0,r.B)("div",{baseStyle:{display:"flex",alignItems:"center",justifyContent:"center"}});a.displayName="Center";const o={horizontal:{insetStart:"50%",transform:"translateX(-50%)"},vertical:{top:"50%",transform:"translateY(-50%)"},both:{insetStart:"50%",top:"50%",transform:"translate(-50%, -50%)"}};(0,n.R)((function(e,t){const{axis:s="both",...n}=e;return(0,i.jsx)(r.B.div,{ref:t,__css:o[s],...n,position:"absolute"})}))},ZDlI:(e,t,s)=>{s.d(t,{m:()=>l});var i=s("nKUr"),r=s("qpfk"),n=s("XuBo"),a=s("xi32"),o=s("JFGw"),c=s("M62g");const l=(0,a.R)((function(e,t){const{className:s,centerContent:a,...l}=(0,r.M)(e),d=(0,o.V)("Container",e);return(0,i.jsx)(c.B.div,{ref:t,className:(0,n.cx)("chakra-container",s),...l,__css:{...d,...a&&{display:"flex",flexDirection:"column",alignItems:"center"}}})}));l.displayName="Container"}}]);